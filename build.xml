<?xml version="1.0" encoding="UTF-8"?>
      <project name="laravel" default="prod">

    <target name="clean">
        <delete dir="./reports"/>
    </target>
<target name="prepare" depends="clean">

    <echo msg="Making directory ./build"/>
    <mkdir dir="./build"/>
    <mkdir dir="./reports/logs"/>
    <mkdir dir="./coverage-report"/>
</target>

    <target name="build" depends = "prepare">
        <echo msg="Copiando archivos al directorio build..."></echo>
        <copy file="./index.php" tofile="./build/index.php"></copy>
    </target>

    <target name="prod" depends="build">
        <echo msg="Creando archivo..."/>
        <tar destfile="./build/build.tar.gz" compression="gzip">
            <fileset dir="./build">
                <include name="*"/>
            </fileset>
        </tar>
        <echo msg="Archivos copiados y compromidos en el directorio build  OK!"/>
        </target>




    <target name="coverage-report" depends="build">
        <coverage-setup database="./database">
            <fileset dir=".">
                <include name="*.php"/>
                <exclude name="*Test.php"/>
            </fileset>
        </coverage-setup>



    <phpunit codecoverage="true" printsummary="true" haltonfailure="true" pharlocation="/usr/local/bin/phpunit">
        <formatter todir="./reports/logs" type="xml"/>
        <batchtest>
            <fileset dir="./">
                <include name="tests/*Test*.php"/>
            </fileset>
        </batchtest>
        <formatter type="xml" todir="./reports" outfile="logfile.xml"/>
    </phpunit>
        <coverage-report outfile="coverage-report/coverage.xml">
            <report styledir="/usr/lib/php/data/phing/etc"
                    todir="coverage-report"/>
        </coverage-report>



         <phpunitreport infile="./reports/logfile.xml"
                        styledir="/usr/share/php/data/phing/etc"
                        format="frames"
                        todir="./reports"/>

     </target>
</project>