<?xml version="1.0" encoding="UTF-8"?>
<project name="laravelhmis2016" default="prod">


	<target name="prepare">

		<echo msg="Making directory ./build"/>
		<mkdir dir="./build"/>
		<mkdir dir="./reports"/>
		<mkdir dir="./reports/logs"/>
		<mkdir dir="./reports/coverage"/>
		<mkdir dir="./coverage-report"/>
	</target>

	<target name="build" depends = "prepare">
		<echo msg="Copiando archivos al directorio build..."></echo>
		<copy file="./index.php" tofile="./build/index.php"></copy>
	</target>

	<target name="prod" depends="build">
		<echo msg="Creando archivo..."/>
		<tar destfile="./build/build.tar.gz" compression="gzip">
			<fileset dir="./build">
				<include name="*"/>
			</fileset>
		</tar>
		<echo msg="Archivos copiados y compromidos en el directorio build"/>
	</target>

	<target name="test" depends="prod">
		<coverage-setup database="./reports/coverage.db">
			<fileset dir="./">
				<include name="**/*.php"/>
				<exclude name="**/*Test.php"/>
			</fileset>
		</coverage-setup>
		<phpunit codecoverage="true" haltonfailure="true" haltonerror="true">
			<formatter type="clover" usefile="false"/>
			<batchtest>
				<fileset dir="src">
					<include name="*Test*.php"/>
				</fileset>
			</batchtest>
		</phpunit>

	</target>
</project>